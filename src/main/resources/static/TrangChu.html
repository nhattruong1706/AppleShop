<!DOCTYPE html>
<html lang="vi" ng-app="myApp">
<head>
    <meta charset="UTF-8">
    <title>Trang chủ</title>
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
    <!-- AngularJS -->
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.8.2/angular.min.js"></script>

    <style>
        body {
            background: #f4f6f9;
        }
        .container {
            margin-top: 50px;
        }
        .user-card {
            max-width: 500px;
            margin: auto;
            padding: 20px;
            border-radius: 12px;
            background: #fff;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body ng-controller="UserController">

<div class="container">
    <div class="user-card text-center" ng-if="currentUser">
        <h3 class="mb-3">Xin chào, <span class="text-primary">{{currentUser.username}}</span></h3>

        <button ng-click="logout()" class="btn btn-danger mt-3">Đăng xuất</button>
    </div>

    <div class="alert alert-warning text-center" ng-if="!currentUser">
        <p>Không có thông tin người dùng. Vui lòng <a href="/dangnhap.html">đăng nhập</a>.</p>
    </div>
</div>

<script>
    var app = angular.module('myApp', []);

    app.controller('UserController', function($scope, $http) {
        $scope.currentUser = null;

        // Lấy thông tin user từ API
        // GET /me
        // Lấy user hiện tại
        $http.get('/api/auth/me', { withCredentials: true })
            .then(function(response) {
                $scope.currentUser = response.data;
            })
            .catch(function(error) {
                console.error("Không thể lấy thông tin user:", error);
            });

// Logout
        $scope.logout = function() {
            $http.post('/api/auth/logout')
                .then(function() {
                    $scope.currentUser = null;
                    window.location.href = '/dangnhap.html'; // redirect
                })
                .catch(function(err) {
                    console.error("Logout thất bại:", err);
                });
        };


    });
</script>


</body>
</html>
